webpackJsonp([1],{"4QT+":function(t,e){},D8lZ:function(t,e){},JxVo:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("7+uW"),a=s("8f98"),r=s.n(a),n=s("FfS/"),d=s.n(n),o=s("DtRx"),h=s.n(o),l=s("M4fF");var c=()=>{const t=navigator.userAgent.toLowerCase();return t.indexOf("chrome")>-1?"google-chrome":t.indexOf("safari")>-1?"safari":"general"},u={data:()=>({dimension:null}),props:{id:{type:String,required:!0},index:{type:Number,required:!0},maxIndex:{type:Number,required:!0}},mounted(){this.$parent.$on("dimensions",t=>{this.dimension=t[this.id]?t[this.id]:null}),this.ro=new ResizeObserver(t=>{t.forEach((t,e)=>{this.$emit("resizeitem",{id:this.id,dimensions:{w:t.target.offsetWidth,h:t.target.offsetHeight}})})}),this.ro.observe(this.$el)},computed:{styles(){return this.dimension?`transform: translate3d(0, ${this.dimension.top}px, 0)`:""}}},m={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"item",staticClass:"VirtualStream__Item",style:this.styles,attrs:{"data-id":"id"}},[this._t("default")],2)},staticRenderFns:[]};var p=s("VU/8")(u,m,!1,function(t){s("a9Kf")},"data-v-95f07430",null).exports;c();var f={name:"VirtualStream",components:{Item:p},props:{items:{type:Array,required:!0},reversed:{type:Boolean,default:!1},preload:{type:Number,default:25}},data:()=>({start:0,end:0,dimensions:{},totalHeight:0}),computed:{currentView(){return this.items.slice(this.startIndex,this.endIndex)},startIndex(){return this.start-this.preload<0?0:this.start-this.preload},endIndex(){return this.end+this.preload>this.items.length?this.items.length:this.end+this.preload},identifier(){let t=[],e={};return this.items.forEach((s,i)=>{t[i]=s.id,e[s.id]=i}),{indexes:t,ids:e}}},methods:{handleScroll:Object(l.throttle)(function(){this.$emit("scroll");const t=this.$refs.wrapper.scrollTop,e=this.$refs.wrapper.offsetHeight+this.$refs.wrapper.scrollTop,s=Object.values(this.dimensions),i=s.filter(e=>{const s=e.top+e.height;return t>=e.top&&t<=s}),a=s.filter(t=>{const s=t.top+t.height;return e>=t.top&&e<=s});i[0]&&this.handleStart(i[0].id),a[0]&&this.handleEnd(a[0].id)},200),handleStart(t){const e=this.identifier.ids[t];this.start=e},handleEnd(t){const e=this.identifier.ids[t];this.end=e},updateItemDimensions(t){this.$refs.items.forEach((t,e)=>{const s=(()=>{const e=this.identifier.ids[t.id]-1;if(e<0)return 0;const s=this.identifier.indexes[e];return this.dimensions[s]?this.dimensions[s].top+this.dimensions[s].height:0})();this.dimensions[t.id]={height:t.$el.offsetHeight,width:t.$el.offsetWidth,top:s,id:t.id},this.$emit("dimensions",this.dimensions)}),this.totalHeight=Object.values(this.dimensions).reduce((t,e)=>{return(t.height?t.height:t)+(e.height?e.height:e)}),this.$refs.track.style.height=this.totalHeight+"px"},updateItemDimension(t){Object.assign(this.dimensions[t.id],t.dimensions)}},watch:{currentView(t){this.$nextTick(()=>{this.updateItemDimensions()})}},mounted(){this.$nextTick(()=>{this.updateItemDimensions(),window.addEventListener("resize",Object(l.debounce)(()=>{this.$refs.track.style.height=0,this.updateItemDimensions()},350))})}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"container",staticClass:"VirtualStream__Scroller"},[s("div",{ref:"wrapper",staticClass:"VirtualStream__Wrapper",on:{"&scroll":function(e){return t.handleScroll(e)}}},[s("div",{ref:"track",staticClass:"VirtualStream__Track"},t._l(t.currentView,function(e,i){return s("Item",{key:e.id,ref:"items",refInFor:!0,attrs:{id:e.id||i,index:i,maxIndex:t.currentView.length-1},on:{resizeitem:t.updateItemDimension,setstart:t.handleStart,setend:t.handleEnd}},[t._t("default",null,{item:e,index:i})],2)}),1)])])},staticRenderFns:[]};var v=s("VU/8")(f,g,!1,function(t){s("xG3+")},"data-v-f6aad78c",null).exports,_={props:{data:{type:Object,required:!0}}},x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"Message"},[s("div",{staticClass:"Message__Wrapper",class:{"Message__Wrapper--isAuthor":t.data.isRight}},[s("div",{staticClass:"Message__Bubble",class:{"Message__Bubble--isAuthor":t.data.isRight}},[t.data.isRight?t._e():s("div",{staticClass:"Author"},[s("img",{staticClass:"Author__Avatar",attrs:{src:t.data.avatar,alt:t.data.author}}),t._v(" "),s("span",{staticClass:"Author__Name"},[t._v(t._s(t.data.author))])]),t._v(" "),s("div",{staticClass:"Text"},[t._v(t._s(t.data.message))])]),t._v(" "),t.data.attachment?s("div",{staticClass:"Attachment",class:{"Attachment--isAuthor":t.data.isRight}},[s("div",{staticClass:"Attachment__Overlay"},[s("div",{staticClass:"Attachment__Author"},[t._v(t._s(t.data.author))])]),t._v(" "),s("img",{staticClass:"Attachment__Preview",attrs:{src:t.data.attachment}})]):t._e()])])},staticRenderFns:[]};var b={name:"App",components:{VirtualStream:v,Message:s("VU/8")(_,x,!1,function(t){s("4QT+")},"data-v-712e36be",null).exports},data(){return{items:this.generateMessages(4e3)}},methods:{generateMessages(t){const e=[];for(let s=0;s<t;s++)e.push(this.generateMessage(s));return e},generateMessage(t){const e=Math.floor(10*Math.random())>7,s=Math.floor(20*Math.random())>16;return{id:h()(),author:d.a.name.findName(),avatar:d.a.fake("{{image.avatar}}"),message:r()({sentenceLowerBound:5,sentenceUpperBound:30}),attachment:s?d.a.fake("{{image.imageUrl}}"):null,isRight:e}},addMessage(){this.items.push(this.generateMessage(this.items.length))},updateItemsPerChunk(t){this.itemsPerChunk=Number(t.currentTarget.value)}},mounted(){this.stream=this.$refs.stream}},C={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"app",attrs:{id:"app"}},[e("div",{staticClass:"container"},[e("div",{staticClass:"container-inner"},[e("virtual-stream",{ref:"stream",attrs:{items:this.items,preload:16,"throttle-timing":5e3},scopedSlots:this._u([{key:"default",fn:function(t){var s=t.item;return[e("Message",{attrs:{data:s}})]}}])})],1),this._v(" "),e("div",{staticClass:"toolbar"},[e("div",[e("button",{on:{click:this.addMessage}},[this._v("Add message")]),e("br")])])])])},staticRenderFns:[]};var $=s("VU/8")(b,C,!1,function(t){s("JxVo"),s("nKyO"),s("D8lZ")},"data-v-64443214",null).exports;i.a.config.productionTip=!1,new i.a({el:"#app",components:{App:$},template:"<App/>"})},a9Kf:function(t,e){},nKyO:function(t,e){},"xG3+":function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.e86dfa02bf438150e36e.js.map